<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132855659-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-132855659-1');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>npm run pls-build</title>
    <meta name="Description" content="This is my personal website :)">

    <meta property="og:url" content="https://corycrowley.me" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Cory Crowley" />
    <meta property="og:image" content="/img/site_image.png"/>
    <meta property="og:description" content="Cory Crowley" />
    
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Balsamiq+Sans&family=Quicksand&family=Comfortaa:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>:root{--red: #C5004A;--darkred: #7F0036;--lightgray: #e0e0e0;--gray: #C0C0C0;--darkgray: #333;--navy: #17050F;--blue: #082840;--white: #fff}*{box-sizing:border-box}html,body{padding:0;margin:0;font-family:"Comfortaa",cursive;color:var(--darkgray);background-color:var(--white);max-width:800px;position:relative;margin-left:auto;margin-right:auto}html img,body img{max-width:100%;display:block;margin-left:auto;margin-right:auto}p:last-child{margin-bottom:0}p,.tmpl-post li{line-height:1.45}a[href]{color:var(--blue)}a[href]:visited{color:var(--navy)}main{padding:1rem}header{border-bottom:1px dashed var(--lightgray)}header:after{content:"";display:table;clear:both}table{margin:1em 0}table td,table th{padding-right:1em}pre,code{font-family:Consolas,Menlo,Monaco,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L","Courier New",Courier,monospace;line-height:1.5}pre{font-size:14px;line-height:1.375;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;background-color:#f6f6f6}.highlight-line{display:block;padding:.125em 1em;text-decoration:none;color:inherit}.highlight-line:empty:before{content:" "}.highlight-line+br{display:none}.highlight-line-isdir{color:#b0b0b0;background-color:#222}.highlight-line-active{background-color:#444;background-color:rgba(69,69,69,.8)}.highlight-line-add{background-color:#45844b}.highlight-line-remove{background-color:#902f2f}.home{padding:0 1rem;float:left;margin:1rem 0;font-size:1em}.home :link:not(:hover){text-decoration:none}.nav{padding:0;list-style:none;float:left;margin-left:1em}.nav-item{display:inline-block;margin-right:1em}.nav-item a[href]:not(:hover){text-decoration:none}.nav-item-active{font-weight:700;text-decoration:underline}.postlist{list-style:none;padding:0}.postlist-item{background-color:#f2f2f2;border:2px solid transparent;cursor:pointer;overflow:hidden;counter-increment:start-from -1}.postlist-item:hover{border:2px solid #000}.postlist-item .projectHeadingWrapper{display:inline-flex;align-items:center;flex-wrap:wrap;width:100%}.postlist-item .projectHeadingWrapper>*{margin-bottom:6px}.postlist-item .projectHeadingWrapper .projectHeading{display:flex;align-items:center}@media screen and (max-width: 768px){.postlist-item .projectHeadingWrapper .projectHeading .projectHeadingNo{font-size:.9em}}.postlist-item .projectSubtitle{margin-top:-2px;font-style:italic}@media screen and (max-width: 768px){.postlist-item .projectSubtitle{font-size:.9em}}.postlist-date{color:#4d4d4d;word-spacing:-0.5px;padding-right:10px;font-size:.9em}@media screen and (max-width: 768px){.postlist-date{font-size:.8em}}.postlist-link{text-decoration:none;overflow-wrap:break-word;word-wrap:break-word;hyphens:auto;display:inline-block;width:100%;padding:0px 10px 0px 5px}.postlist-item-active .postlist-link{font-weight:bold}.tmpl-home .postlist-link{font-size:1.1em;font-weight:700}@media screen and (max-width: 768px){.tmpl-home .postlist-link{font-size:.9em}}.tag{display:inline-block;vertical-align:text-top;font-size:.825em;background-color:#fff;padding:2px 4px;margin-right:.8em;color:var(--white);border-radius:.25em;text-decoration:none;border:1px solid #000}@media screen and (max-width: 768px){.tag{font-size:.3em}}.tag:hover{background-color:#000;transition:ease-in-out .2s}a[href].tag,a[href].tag:visited{color:#000}a[href].tag:hover,a[href].tag:visited:hover{color:#fff;transition:ease-in-out .2s}.taggedSpan{display:inline-block;padding:2px 8px;margin-right:.8em;background-color:#000;color:var(--white);color:#fff;border:2px solid #000;border-radius:.25em;text-decoration:none}.allTagWrapper{display:flex;flex-wrap:wrap;font-size:xx-large}.allTagWrapper>*{margin:5px}@media screen and (max-width: 768px){.allTagWrapper{font-size:x-large}.allTagWrapper .tag{font-size:initial}}.allTagWrapper .allTagItem{background-color:#fff;color:#000 !important;padding:2px 6px}.allTagWrapper .allTagItem:hover{background-color:#000;color:#fff !important;transition:ease-in-out .2s}.warning{background-color:#ffc;padding:1em .625em}.warning ol:only-child{margin:0}.direct-link{font-family:sans-serif;text-decoration:none;font-style:normal;margin-left:.1em}a[href].direct-link,a[href].direct-link:visited{color:transparent}a[href].direct-link:focus,a[href].direct-link:focus:visited,:hover>a[href].direct-link,:hover>a[href].direct-link:visited{color:#aaa}.postTitle{margin-bottom:0px}.postSubtitle{margin-top:5px;margin-bottom:5px}.dateHeader{display:inline}.postlist{margin-bottom:0px;margin-top:0px}.postlist .postlist-item{border-radius:5px;margin-bottom:10px;margin-top:10px;padding:8px 8px 8px 8px}.recentTitle{font-size:medium;font-weight:800}.recentItems{display:flex;justify-content:flex-start;flex-direction:column;margin-bottom:20px}.recentItems h1,.recentItems h2,.recentItems h3,.recentItems h4,.recentItems h5{margin-bottom:0px}.recentItems .postCallout{margin-top:-5px}@keyframes wobble{33%{transform:rotate(-5deg)}66%{transform:rotate(5deg)}}.jumbo{margin-bottom:20px}.jumbo .jumboName{height:134px;font-family:"Indie Flower",cursive;text-align:center;font-size:80px}@media screen and (max-width: 768px){.jumbo .jumboName{font-size:12vw}}@media screen and (max-width: 425px){.jumbo .jumboName{height:75px}}.jumbo .socialLinks{margin-top:10px;display:flex;justify-content:center}.jumbo .socialLinks .socialLink{padding-right:20px}.jumbo .socialLinks .socialLink svg{width:40px;height:auto}.jumbo .socialLinks .socialLink svg:hover{animation:wobble .4s}@media screen and (max-width: 425px){.jumbo .socialLinks .socialLink svg{width:32px}}.jumbo .socialLinks .socialLink.twitter svg{fill:#1da1f2}.jumbo .socialLinks .socialLink.soundcloud svg{fill:#f70}.jumbo .socialLinks .socialLink.github svg{fill:#000}.jumbo .socialLinks .socialLink.linkedin svg{fill:#0e76a8}.recentTitle{font-size:1.2em}.postTagsWrapper{margin-top:5px;margin-bottom:15px}.postTagsWrapper .tagHeader{display:inline;margin-top:0px;margin-bottom:0px;padding-right:10px}.postTagsWrapper span{display:flex;align-items:center}.postTagsWrapper a{margin-top:3px}.projectLinkWrapper{display:flex;flex-wrap:wrap}.projectLinkWrapper .projectLink{display:flex;justify-content:flex-start;align-items:center;width:max-content;padding-right:20px}.projectLinkWrapper .projectLink .projectLinkIcon{padding-right:10px}.projectLinkWrapper .projectLink .projectLinkIcon svg{width:30px;height:auto}.projectImageContainer img{max-height:800px;width:auto;left:0px;right:0px;margin:auto}.video-container{position:relative;padding-bottom:56.25%;padding-top:30px;height:0;overflow:hidden;margin-bottom:40px}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}.tmpl-post,.tmpl-project{max-width:800px;left:0px;right:0px;margin:auto}.tmpl-post blockquote,.tmpl-project blockquote{padding:10px 10px 10px 10px;background-color:#f2f2f2;font-style:italic;border-radius:5px}.tmpl-post blockquote>p:first-child,.tmpl-project blockquote>p:first-child{margin-top:0px}.resumeFrame{width:100%;height:600px}@media screen and (max-width: 800px){.resumeFrame{display:none}}@media screen and (max-width: 800px){.backToResume{display:none}}/*# sourceMappingURL=global.css.map */
</style>
    <style>code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#708090}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#a6e22e}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function,.token.class-name{color:#e6db74}.token.keyword{color:#66d9ef}.token.regex,.token.important{color:#fd971f}.token.important,.token.bold{font-weight:bold}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{position:relative;padding:1em 0 1em 3em}.line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:rgba(153,122,102,.08);background:linear-gradient(to right, rgba(153, 122, 102, 0.1) 70%, rgba(153, 122, 102, 0));pointer-events:none;line-height:inherit;white-space:pre}.line-highlight:before,.line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:rgba(153,122,102,.4);color:#f5f2f0;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}.line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}.line-numbers .line-highlight:before,.line-numbers .line-highlight:after{content:none}pre[id].linkable-line-numbers span.line-numbers-rows{pointer-events:all}pre[id].linkable-line-numbers span.line-numbers-rows>span:before{cursor:pointer}pre[id].linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(128,128,128,.2)}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}div.code-toolbar{position:relative}div.code-toolbar>.toolbar{position:absolute;top:.3em;right:.2em;transition:opacity .3s ease-in-out;opacity:0}div.code-toolbar:hover>.toolbar{opacity:1}div.code-toolbar:focus-within>.toolbar{opacity:1}div.code-toolbar>.toolbar .toolbar-item{display:inline-block}div.code-toolbar>.toolbar a{cursor:pointer}div.code-toolbar>.toolbar button{background:none;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;padding:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}div.code-toolbar>.toolbar a,div.code-toolbar>.toolbar button,div.code-toolbar>.toolbar span{color:#bbb;font-size:.8em;padding:0 .5em;background:#f5f2f0;background:rgba(224,224,224,.2);box-shadow:0 2px 0 0 rgba(0,0,0,.2);border-radius:.5em}div.code-toolbar>.toolbar a:hover,div.code-toolbar>.toolbar a:focus,div.code-toolbar>.toolbar button:hover,div.code-toolbar>.toolbar button:focus,div.code-toolbar>.toolbar span:hover,div.code-toolbar>.toolbar span:focus{color:inherit;text-decoration:none}span.inline-color-wrapper{background:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyIDIiPjxwYXRoIGZpbGw9ImdyYXkiIGQ9Ik0wIDBoMnYySDB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik0wIDBoMXYxSDB6TTEgMWgxdjFIMXoiLz48L3N2Zz4=");background-position:center;background-size:110%;display:inline-block;height:1.333ch;width:1.333ch;margin:0 .333ch;box-sizing:border-box;border:1px solid #fff;outline:1px solid rgba(0,0,0,.5);overflow:hidden}span.inline-color{display:block;height:120%;width:120%}/*# sourceMappingURL=monokai.css.map */
</style>
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Cory">
    
    <script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script><script src="/sss/sss.min.js"></script><link rel="stylesheet" href="/sss/sss.css" type="text/css" media="all">
    <script>jQuery(function($) {$('.slider').sss({ slideShow : true, transition : 400, speed : 8000});;});</script>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/img/favicon/site.webmanifest">
  </head>
  <body>
  <!-- Buy me a coffee -->
    <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="corycrowley" data-description="Caffeine keeps me going :  ) " data-message="" data-color="#5F7FFF" data-position="right" data-x_margin="18" data-y_margin="18"></script>
    <header>
      
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Blog</a></li>
        <li class="nav-item"><a href="/projects/">Projects</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
        <li class="nav-item"><a href="/resume/">Resume</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1 class="postTitle">npm run pls-build</h1>
<h3 class="postSubtitle">Authoring a TypeScript library with Rollup.js</h3>
<span><h4 class="dateHeader">Date:</h4> 19 Oct 2020</span>

    <div class="postTagsWrapper">
    <span>
        <h4 class="tagHeader">Tags:</h4>
        
            
        
            
        
            
        
            
                <a href="/tagged/microsoft/" class="tag">microsoft</a>
        
        </span>
    </div>


<h2 id="tsiclient">TsiClient <a class="direct-link" href="#tsiclient">#</a></h2>
<p>After starting at Microsoft, one of my first projects was to update the build system for our team's front-end library, <a href="https://github.com/microsoft/tsiclient">TsiClient</a>, a library for creating complex visualizations like the scatter plot below, easily.  If your interested in the tech behind this scatter plot, I wrote another post about that <a href="/projects/iot_tsi_internship/">here</a></p>
<div id="tsi-root" style="height: 400px;">
</div>
<div>
    <label>Time Slider</label>
    <select onchange='(function(){ toggleChartOption("isTemporal", (event.target.value === "true")) })(event)'>
            <option value="true">true</option>
            <option value="false" selected="">false</option>
    </select>
</div>
<p>This plot is created using these three lines of code<br>
<img src="/img/authoring-library/umd_script.png" alt="Scatter plot"></p>
<p>Where data is an array of json time-series data, and chartOptions / chartDataOptions are objects specifying how you want the chart to look.</p>
<h2 id="what-we-started-with">What we started with <a class="direct-link" href="#what-we-started-with">#</a></h2>
<p>The scatter plot above is inserted into this page using a bundling technique know as <a href="https://github.com/umdjs/umd">Universal Module Definition (UMD)</a>, which bundles the libary code into a single TsiClient.js file.  That file can then be included via script tag into this page.  Sounds great right?</p>
<p>The problem is the size.  Including all of <strong>TsiClient.js</strong> via UMD bundle creates a 2.2MB dependency for this page.  That's huge for just trying to create a scatter plot.  The red box on the image below shows that the external dependencies for this library are bloating the size.  That huuuuuge white square on the left shows the proportional size of an azure maps dependency that isn't even being used by the scatter plot.  Hmm, ok, so there's room for improvement.</p>
<p><img src="/img/authoring-library/original-size.png" alt="Original Size"></p>
<p>So, I did what any new front-end dev does when they have no idea what they're doing... I hit the blogs.</p>
<p><img src="/img/authoring-library/tldr.png" alt=".d.ts typings"></p>
<p>I read about code splitting (separating code into multiple bundles), webpack and rollup (bundling technologies), type declarations (bundling typing files with the library), and tree shaking.  Tree shaking is a buzzword in the world of bundling.  Imagine a tree that represents your code.  The healthy branches are the code that you actually need, while the dead branches are the code that isn't being used (like the maps dependency).  When you shake the tree, the dead branches (unused code) should fall out, leaving only the live branches (code being used).</p>
<p><img src="/img/authoring-library/bloggin.png" alt="Just bloggin"></p>
<p>So I tried to implement some of the techniques I read about, but nothing was working.  Specifically, this syntax of tree shaking wasn't working.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Scatterplot<span class="token punctuation">,</span> LineChart<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'tsiclient'</span><span class="token punctuation">;</span></code></pre>
<p>I had created an index file which exported references to each component in our library.  The blogs had promised that webpack would be smart enough to tree shake the library using the syntax above if the consumer only wanted to import certain components, opposed to the entire library.  Long story short, this wasn't working.  It would still bring in all of the unwanted dependencies, or, more frequenty, not work using this es-module (esm) syntax at all. Ok, so the magic of tree shaking wasn't working.  What else could I try?</p>
<p>I switched over to Rollup.js - a bundling technology more suited to libraries.  I learned that there was an alternative to tree shaking called direct component imports.  That syntax looks like this.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Linechart <span class="token keyword">from</span> <span class="token string">'tsiclient/LineChart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Scatterplot <span class="token keyword">from</span> <span class="token string">'tsiclient/Scaterplot'</span><span class="token punctuation">;</span></code></pre>
<p>Rather than relying on tree shaking to trace what code is actually touched, why not just bundle each component into it's own chunk, and only include that code if explicitly imported?  So that's exactly what I built.</p>
<h2 id="a-simple-example">A simple example <a class="direct-link" href="#a-simple-example">#</a></h2>
<p>Here's an example of how this works.  In the image below, the left side represents a UMD build, while the right represents a multiple entry point build.  To make things simple, this diagram illustrates a simple library for converting string cases.</p>
<p><img src="/img/authoring-library/umd_vs_direct.png" alt="Multiple entry points"></p>
<h3 id="umd">UMD <a class="direct-link" href="#umd">#</a></h3>
<p>On the left, you can see all of the components bundled into a single file with one entry point, <code>main.js</code>.  This technique is often useful if you need to include the library via script tag, or as a fallback for front-end / back-end apps which want to bring in the entire library.</p>
<h3 id="esm---direct-component-imports">ESM - direct component imports <a class="direct-link" href="#esm---direct-component-imports">#</a></h3>
<p>On the right, you can see that the output is split into multiple entry points.</p>
<ul>
<li><code>main.js</code> which has references to the entire library,</li>
<li><code>upperFirst.js</code> which converts the first character of a string to uppercase and has a dependency on the <code>upper.js</code> chunk</li>
<li><code>lower.js</code> which exposes an entry point for lower casing functionality</li>
<li><code>upper.js</code> which exposes the upper casing functionality.</li>
</ul>
<p>The pink chunk shown at the bottom contains shared dependencies between multiple output chunks. It is also separated into its own chunk to eliminate any code duplication.</p>
<p>So how does this work in practice?  Well, if I only need the code which converts strings to lowercase, I'll import the <code>lower.js</code> entry point.  Something like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> lower <span class="token keyword">from</span> <span class="token string">'casing/lower.js'</span></code></pre>
<p>That will bring in the blue chunk and the pink chunk shown in the diagram above.  The entry file <code>lower.js</code> has references to the files that it needs: <code>lowerChar.js</code> and <code>constants.js</code>, and <code>lowerChar.js</code> has a reference to <code>shiftChar.js</code> so that is also imported.</p>
<p>So rather than importing the entire library, we just cut down this import to 4 files, only including what we actually use.</p>
<h2 id="type-declarations">Type declarations <a class="direct-link" href="#type-declarations">#</a></h2>
<p>Last, but not least, I want to mention budling type declaration files.</p>
<p>When authoring a TypeScript library, it's important to include <code>.d.ts</code> typing files with your bundles.  This will ensure that anyone using your library knows what parameters each function takes, how to properly construct your classes, and which types to pass around. Normally, when converting TypeScript code into JavaScript, the <code>.d.ts</code> typing files will be nested into a directory structure which matches the source code (shown on left in image below).  This doesn't work well when emitting bundles.</p>
<p>For the typings to be propery included into an application which consumes your library, the typing files must be in the same location, and with the same name as the bundled <code>.js</code> files (shown on right in image below).  This ensures that any bundle you import will bring the associated typing file with it.  Luckily, there's an amazing <a href="https://github.com/wessberg/rollup-plugin-ts">Rollup plugin</a> which does this for you.  Whew.</p>
<p><img src="/img/authoring-library/typing.png" alt=".d.ts typings"></p>
<h2 id="sugar-on-top">Sugar on top <a class="direct-link" href="#sugar-on-top">#</a></h2>
<p>Converting to an optimized, direct component import pattern significantly reduces the dependency size of including the TsiClient library in an application.  Here are some of the results.</p>
<p><img src="/img/authoring-library/size_reduction.png" alt="optimization results"></p>
<p>In the image above, on the left is the UMD, monolothic bundle approach, tested in a create-react-app, importing the LineChart.</p>
<p>On the right, is the es-module direct component import approach, tested in a create-react-app, importing the LineChart.</p>
<p>That's a 68% reduction in size!</p>
<p>Here is a visualization of the optimized output bundles, where each colored square represents a different component of the library that can be directly imported.</p>
<p><img src="/img/authoring-library/esm_viz.png" alt="esm visualization"></p>
<script src="https://unpkg.com/tsiclient@1.3.19/tsiclient.js"></script>
<link rel="stylesheet" type="text/css" href="https://unpkg.com/tsiclient@1.3.19/tsiclient.css"></link>
<script>
let data;
let chartDataOptions;
let scatterPlot;

// Set chart options
let chartOptions = {
    theme: 'light',
    yExtent: [0,1], 
    legend: screen.width > 650 ? 'shown' : 'compact', 
    offset: 'Local', 
    tooltip: true, 
    canDownload: false, 
    hideChartControlPanel: false, 
    is24HourTime: false, 
    singleLineXAxisLabel: '',
    xAxisHidden: false, 
    yAxisHidden: false,
    includeDots: false,
    includeEnvelope: false,
    interpolationFunction: 'curveMonotoneX',
    yAxisState: 'stacked',
    brushHandlesVisible: false,
    snapBrush: false,
    stacked: false, 
    zeroYAxis: true,
    arcWidthRatio: 1,
    spMeasures: ['avg', 'min', 'max'],
    isTemporal: false,
    spAxisLabels: null
}

function toggleChartOption(property, value = null) {
    //if value is null, assume a toggle
    chartOptions[property] = (value === null) ? !chartOptions[property] : value; 
    scatterPlot.render(data, chartOptions, chartDataOptions);
}

window.onload = function(){
    // Create fake data
    data = [];
    let minute = 60*1000
    let from = new Date(Math.floor(new Date(new Date().valueOf() / minute)) * minute);
    let to;
    for(let i = 0; i < 2; i++){
        let lines = {};
        data.push({[`Factory ${i}`]: lines});
        for(let j = 0; j < 3; j++){
            let values = {};
            lines[`Sensor ${j}`] = values;
            for(let k = 0; k < 10; k++){
                // if(!(k%2 && k%3)){  // if check is to create some sparseness in the data
                    to = new Date(from.valueOf() + 1000*60*k);
                    let val = Math.random() / 2 + .25;
                    let minVal = val - (Math.random() / 10);
                    let maxVal = val + (Math.random() / 10);
                    values[to.toISOString()] = {avg: val, min: minVal, max: maxVal};
                // }
            } 
        }
    }
    
    
    let searchSpan = {
        from: from.toISOString(),
        to: to.toISOString(),
        bucketSize: '1d'
    }
    chartDataOptions = data.map(d => {
        return {searchSpan: searchSpan};
    });

    let tsiClient = new TsiClient(); // Create TsiClient
    scatterPlot = new tsiClient.ux.ScatterPlot(document.getElementById('tsi-root'))
    scatterPlot.render(data, chartOptions, chartDataOptions); // Render Scatter
}
</script>





<p><a href="/posts">← Blog</a></p>

    </main>

    <footer></footer>

    <!-- Current page: /posts/authoring-library/ -->
    <script type="text/javascript">
    function linkClick(target){
      window.location = target;
    }
    </script
  </body>
</html>
